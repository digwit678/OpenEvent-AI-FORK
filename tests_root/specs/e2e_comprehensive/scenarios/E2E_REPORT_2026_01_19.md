# E2E Test Report - January 19, 2026

## Test Session Summary

| Metric | Value |
|--------|-------|
| Date | January 19, 2026 (21:09-21:11) |
| Environment | Frontend (localhost:3000) + Backend (localhost:8000) |
| Mode | Hybrid (I:gem, E:gem, V:ope) |
| All Tests Passed | **YES** |

## Test Results

| # | Test Case | Status | Details |
|---|-----------|--------|---------|
| 1 | Initial Booking Request | **PASS** | Offer generated with proper LLM verbalization |
| 2 | Q&A (Room Features) | **PASS** | Parking & accessibility info returned correctly |
| 3 | Billing Capture | **PASS** | Address captured and persisted |
| 4 | Date Change Detour | **PASS** | New offer generated for changed date |

---

## Detailed Test Results

### Test 1: Initial Booking Request
**Input:** "I'd like to book Room A for 30 people on March 15, 2026, from 14:00 to 18:00"

**Expected:** Offer generated for Room A

**Result:** PASS
- Offer generated: Room A, CHF 500.00
- Deposit: CHF 150.00
- Due date: 05 March 2026
- Proper LLM verbalization: "Here is your offer for Room A, accommodating 30 participants. Let me know if you have any questions or need further details!"

### Test 2: Q&A - Room Features
**Input:** "Does Room A have parking available? And what about wheelchair accessibility?"

**Expected:** Factual response about parking and accessibility from room data

**Result:** PASS
- Parking info: "Underground parking at Europaallee is two minutes from the venue with direct lift access"
- Accessibility: "Room A is fully accessible: wheelchair accessible, elevator access, step-free entry, accessible bathroom on-site"
- No fallback message - actual room data returned

### Test 3: Billing Capture
**Input:** "I accept the offer. Our billing address is: Acme Corp, Bahnhofstrasse 42, 8001 Zurich, Switzerland"

**Expected:** Billing address captured and stored

**Result:** PASS
- Billing captured: "Bahnhofstrasse 42, 8001 Zurich, Switzerland"
- Company name captured: "Acme Corp"
- Note: Routing went to Step 3 instead of Step 5, but billing was correctly stored

### Test 4: Date Change Detour
**Input:** "I want Room A. But I need to change the date to April 10, 2026 instead."

**Expected:** Date changed, new offer generated, billing preserved

**Result:** PASS
- Date changed: 15.03.2026 â†’ **10.04.2026**
- New offer generated with updated date
- Deposit due date recalculated: 31 March 2026
- Billing preserved through detour: "Zurich, Bahnhofstrasse 42, 8001 Zurich, Switzerland"
- Client name preserved: "Acme Corp"

---

## Issues Fixed This Session

### 1. Silent Fallback Messages
**Problem:** API errors (billing issues, rate limits) were hidden behind generic fallback messages like "Thanks for the update. I'll follow up shortly with the latest availability."

**Fix:**
- Updated `api/routes/messages.py` to detect critical API errors and surface them clearly
- Changed `dev_server.sh` to enable `OE_FALLBACK_DIAGNOSTICS=1` by default in dev mode
- Critical API errors now shown with error type and message

### 2. OpenAI Billing Issue
**Problem:** OpenAI API returned 429 "account not active" errors due to billing issue

**Fix:** User connected new credit card - API now working correctly

---

## System Configuration Verified

```
Mode: HYBRID
Intent Classification: Gemini (gem)
Entity Extraction: Gemini (gem)
Verbalization: OpenAI (ope)
Fallback Diagnostics: Enabled
Environment: dev
```

---

## Conclusion

All core E2E scenarios passed:
- Initial offer generation with LLM verbalization
- Q&A functionality returning actual room data
- Billing capture and persistence
- Date change detour with offer regeneration

The silent fallback issue has been fixed - API errors now show clear diagnostic messages in dev mode.
