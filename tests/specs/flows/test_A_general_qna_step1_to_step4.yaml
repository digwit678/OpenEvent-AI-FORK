suite: flow_A_general_qna
initial_clock: 2025-11-11T10:00:00+01:00
steps:
  - turn: 1
    msg_in:
      subject: Private Dinner Event – Date Options in February
      body: |-
        Hello,
        We’d like to organize a private dinner for our family (around 30 guests) at your venue.
        We’re flexible but are thinking sometime in February, preferably a Saturday evening.
        Requirements:
        – Long dining table setup
        – Three-course dinner menu with wine
        – Background music (live or playlist)
        Question: Which vegetarian three-course menus with wine pairing do you offer?
        Many thanks,
        Laura Meier
        laura.meier@bluewin.ch
    expect:
      intent: event_intake_with_question
      user_info:
        participants: 30
        vague_month: February
        vague_weekday: Saturday
        vague_time_of_day: evening
      actions:
        - type: ask_for_date_enqueued
          payload:
            suggested_dates:
              - "2026-02-07"
              - "2026-02-14"
              - "2026-02-21"
              - "2026-02-28"
            event_id: ANY
      status: Lead
      trace:
        subloops: ["general_q_a"]
      res:
        general_qa:
          select_expr: "SELECT menu_name, courses, vegetarian, wine_pairing, price"
          where_clauses: ["courses=3","vegetarian=true","wine_pairing=true"]
          rows_min: 2
        assistant_draft:
          headers: ["General Q&A","Date options for February"]
          contains:
            - "Vegetarian three-course menus with wine pairings"
            - "Saturdays available in February 2026: 07, 14, 21, 28"
  - turn: 1a
    gui_action:
      approve_task: ask_for_date_enqueued
    expect:
      actions:
        - type: send_reply
      res:
        assistant_draft:
          headers: ["General Q&A","Date options for February"]
  - turn: 2
    msg_in:
      body: |-
        Thanks. 21.02.2026 works for us for 30 guests. Please proceed.
    expect:
      intent: event_update
      user_info:
        date: "2026-02-21"
        participants: 30
      actions:
        - type: send_reply
      trace:
        subloops: []
      db_assert:
        gatekeeping:
          attendees: 30
          date: "2026-02-21"
      res:
        assistant_draft:
          headers: ["Next step"]
          contains:
            - "Noted: 30 guests and 21.02.2026."
            - "We'll check room availability next."
  - turn: 3
    system_call: room_status_on_date
    args:
      date: "2026-02-21"
    stub_returns:
      rooms:
        - id: R-A
          name: "Room A"
          capacity: 40
          matched: ["Long dining table","Background music"]
          missing: []
        - id: R-B
          name: "Room B"
          capacity: 32
          matched: ["Long dining table"]
          missing: ["Background music"]
  - turn: 4
    msg_in:
      body: |-
        Let’s go with Room A.
    expect:
      intent: room_choice
      actions:
        - type: send_reply
      status: Option
      res:
        assistant_draft:
          headers: ["Offer"]
          contains:
            - "Offer for Room A on 21.02.2026 for 30 guests"
